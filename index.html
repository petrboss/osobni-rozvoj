<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Osobn√≠ rozvoj ‚Ä¢ MVP</title>
  <meta name="theme-color" content="#0f0f14">
  <style>
    :root{--bg:#0f0f14;--card:#161623;--muted:#2a2a36;--text:#e6e6e6;--accent:#7c9cff}
    *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;background:rgba(15,15,20,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid var(--muted)}
    .container{max-width:1100px;margin:0 auto;padding:14px 16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{font-weight:700;letter-spacing:.3px}
    .btn{background:var(--card);border:1px solid var(--muted);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{filter:brightness(1.06)}
    .hero{padding:32px 16px 8px}
    .hero h1{font-size:clamp(26px,5vw,40px);margin:8px 0 6px}
    .hero p{opacity:.85;margin:0 0 14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--muted);padding:14px;border-radius:14px}
    .tag{display:inline-block;background:#1c1c2b;border:1px solid var(--muted);padding:4px 8px;border-radius:999px;font-size:12px;opacity:.9}
    footer{border-top:1px solid var(--muted);padding:14px 16px;opacity:.8}
    .progress{height:8px;background:#1b1b28;border:1px solid var(--muted);border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:var(--accent);width:0%}
    .pill{display:inline-flex;align-items:center;gap:8px}
    .pill input{appearance:none;width:18px;height:18px;border:2px solid var(--accent);border-radius:4px}
    .pill input:checked{background:var(--accent)}
    @media (max-width:640px){.row-nav{flex-wrap:wrap;gap:8px}}

    /* (ponech√°v√°m i tvoje d≈ô√≠vƒõj≈°√≠ chat-msg styly pro jistotu kompatibility) */
    .chat-msg{max-width:75%;padding:10px 12px;margin:6px 0;border-radius:12px;line-height:1.35}
    .chat-user{margin-left:auto;background:#2a2a36}
    .chat-assistant{margin-right:auto;background:#1b1b28}
    .chat-meta{opacity:.7;font-size:12px;margin-top:4px}
    .typing{opacity:.8;font-style:italic}

    /* === Chat UI (nov√© bubliny) === */
    .chat-wrap{display:flex;flex-direction:column;gap:10px}
    .chat-box{
      height:320px;overflow:auto;padding:12px;
      background:#12121a;border:1px solid var(--muted);border-radius:12px
    }
    .bubble{
      max-width:75%;margin:6px 0;padding:10px 12px;border-radius:14px;
      word-wrap:break-word;white-space:pre-wrap;
      background:#1c1c2b;border:1px solid #2a2a36
    }
    .bubble.user{margin-left:auto;background:#24304a;border-color:#2f3b5d}
    .bubble.ai{margin-right:auto}
    .row-send{display:flex;gap:8px;align-items:flex-end}
    .chat-input{
      flex:1;min-height:40px;max-height:160px;resize:none;
      padding:10px;border-radius:10px;border:1px solid var(--muted);
      background:#12121a;color:var(--text)
    }
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      background:#1b1b28;border:1px solid var(--muted);
      border-radius:999px;padding:6px 10px;cursor:pointer
    }
    .chip:hover{filter:brightness(1.1)}
    .hint{opacity:.7;font-size:12px}
  </style>
</head>
<body>
<header>
  <div class="container row row-nav">
    <div class="brand">Osobn√≠ rozvoj (MVP)</div>
    <nav style="display:flex;gap:8px">
      <a class="btn" href="#kurzy">Kurzy</a>
      <a class="btn" href="#chat">Chat</a>
      <a class="btn" href="#jak-dal">Jak d√°l</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <span class="tag">Krok 1: ≈æiv√Ω web</span>
    <h1>Platforma pro vzdƒõl√°v√°n√≠ & osobn√≠ r≈Øst</h1>
    <p>Toto je prvn√≠ ve≈ôejn√° verze ‚Äì jen statick√° str√°nka. Postupnƒõ p≈ôid√°me p≈ôihl√°≈°en√≠, datab√°zi, AI chat a soci√°ln√≠ prvky.</p>
    <button class="btn" onclick="document.querySelector('#kurzy').scrollIntoView({behavior:'smooth'})">Zaƒç√≠t</button>
  </section>

  <section id="kurzy" style="padding:8px 0 20px">
    <h2>Kurzy (demo)</h2>
    <div class="grid">
      <article class="card">
        <h3>Z√°klady mindsetu</h3>
        <p>Kr√°tk√Ω √∫vod do pr√°ce s c√≠li, n√°vyky a reflex√≠.</p>
        <div class="pill"><input type="checkbox" id="l1"><label for="l1">Lekce 1: C√≠l vs. syst√©m</label></div><br>
        <div class="pill"><input type="checkbox" id="l2"><label for="l2">Lekce 2: Denn√≠ reflexe</label></div><br>
        <div class="pill"><input type="checkbox" id="l3"><label for="l3">Lekce 3: Mini-n√°vyk</label></div>
        <div style="margin-top:10px" class="progress"><div id="p1"></div></div>
      </article>
      <article class="card">
        <h3>Produktivita bez stresu</h3>
        <p>Jak pl√°novat t√Ωden a dr≈æet fokus.</p>
        <div class="pill"><input type="checkbox" id="l4"><label for="l4">Lekce 1: T√Ωdenn√≠ pl√°n</label></div><br>
        <div class="pill"><input type="checkbox" id="l5"><label for="l5">Lekce 2: 3 MITs dennƒõ</label></div><br>
        <div class="pill"><input type="checkbox" id="l6"><label for="l6">Lekce 3: Inbox Zero</label></div>
        <div style="margin-top:10px" class="progress"><div id="p2"></div></div>
      </article>
      <article class="card">
        <h3>Finance pro klid</h3>
        <p>Rozpoƒçet, rezerva a jednoduch√© investice.</p>
        <div class="pill"><input type="checkbox" id="l7"><label for="l7">Lekce 1: 50/30/20</label></div><br>
        <div class="pill"><input type="checkbox" id="l8"><label for="l8">Lekce 2: Rezerva 3‚Äì6 mƒõs√≠c≈Ø</label></div><br>
        <div class="pill"><input type="checkbox" id="l9"><label for="l9">Lekce 3: ETF bez bolesti</label></div>
        <div style="margin-top:10px" class="progress"><div id="p3"></div></div>
      </article>
    </div>
  </section>

  <!-- CHAT -->
  <section id="chat" style="padding:8px 0 20px">
    <h2>Chat</h2>
    <div class="card">
      <div class="chat-wrap">
        <div id="chatBox" class="chat-box" aria-live="polite" aria-label="chat messages"></div>

        <div class="row-send">
          <textarea id="ask" class="chat-input" rows="1"
            placeholder="Napi≈° zpr√°vu a stiskni Enter‚Ä¶"></textarea>
          <button class="btn" id="askBtn">Zeptat se</button>
        </div>

        <div class="hint">Tip: <b>Enter</b> = odeslat, <b>Shift+Enter</b> = nov√Ω ≈ô√°dek.</div>

        <div class="chips">
          <button class="chip" data-chip="Ahoj! Jak ti mohu pomoci?">Ahoj! Jak ti mohu pomoci?</button>
          <button class="chip" data-chip="Napi≈° mi jednu motivaƒçn√≠ vƒõtu.">Napi≈° mi jednu motivaƒçn√≠ vƒõtu.</button>
          <button class="chip" data-chip="Navrhni mi jednoduch√Ω pl√°n na dne≈°ek.">Navrhni mi jednoduch√Ω pl√°n na dne≈°ek.</button>
        </div>
      </div>
    </div>
  </section>

  <section id="ucet" style="padding:8px 0 20px">
    <h2>√öƒçet</h2>
    <div class="card" id="authCard">
      <div id="loggedOut">
        <p>P≈ôihlas se e-mailem (po≈°leme odkaz):</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="email" type="email" placeholder="tvoje@adresa.cz" style="flex:1;min-width:220px;padding:10px;border-radius:10px;border:1px solid var(--muted);background:#12121a;color:var(--text)">
          <button class="btn" id="loginBtn">Poslat p≈ôihla≈°ovac√≠ odkaz</button>
        </div>
        <p id="loginMsg" style="opacity:.8;margin-top:8px"></p>
      </div>
      <div id="loggedIn" style="display:none">
        <p>P≈ôihl√°≈°en: <span id="userEmail"></span></p>
        <button class="btn" id="logoutBtn">Odhl√°sit</button>
      </div>
    </div>
  </section>

  <section id="jak-dal" style="padding:8px 0 32px">
    <h2>Jak budeme pokraƒçovat</h2>
    <ol>
      <li><strong>P≈ôihl√°≈°en√≠ + datab√°ze</strong> (Supabase) ‚Äì u≈æivatelsk√© √∫ƒçty, pr≈Øbƒõh lekc√≠.</li>
      <li><strong>AI chat</strong> p≈ôes serverovou route ‚Äì bezpeƒçnƒõ, bez odhalen√≠ API kl√≠ƒçe.</li>
      <li><strong>PWA instalace</strong> ‚Äì p≈ôidat na plochu, z√°kladn√≠ offline.</li>
      <li><strong>‚ÄûSoci√°ln√≠‚Äú vrstva</strong> ‚Äì p≈ô√≠spƒõvky, koment√°≈ôe, sleduji/sleduj√≠.</li>
    </ol>
  </section>
</main>

<footer class="container">¬© 2025 Osobn√≠ rozvoj ‚Ä¢ MVP ‚Ä¢ Stav√≠me krok za krokem</footer>

<!-- Kurzy: localStorage + progress -->
<script>
  const idsByCourse = [
    ['l1','l2','l3'],
    ['l4','l5','l6'],
    ['l7','l8','l9']
  ];
  function load(){
    idsByCourse.flat().forEach(id=>{
      const v = localStorage.getItem('done:'+id)==='1';
      const el = document.getElementById(id);
      if(el) el.checked = v;
    });
    updateProgress();
  }
  function updateProgress(){
    idsByCourse.forEach((arr,i)=>{
      const done = arr.filter(id=>localStorage.getItem('done:'+id)==='1').length;
      const pct = Math.round(done/arr.length*100);
      const bar = document.getElementById('p'+(i+1));
      if(bar) bar.style.width = pct+'%';
    });
  }
  document.addEventListener('change', (e)=>{
    if(e.target && e.target.id && e.target.type==='checkbox'){
      localStorage.setItem('done:'+e.target.id, e.target.checked?'1':'0');
      updateProgress();
    }
  });
  load();
</script>

<!-- Supabase login -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

  const SUPABASE_URL  = 'https://qcknmwqnfpeknwqmlxgj.supabase.co';
  const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFja25td3FuZnBla253cW1seGdqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4NTY1ODUsImV4cCI6MjA3MTQzMjU4NX0.MrQgO3N2JHXOPHxxemVhu7MzbXlDkqDiMmVvZbVF_UE';
  const REDIRECT_URL  = 'https://petrboss.github.io/osobni-rozvoj/';

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

  const $ = s => document.querySelector(s);
  const loginBtn  = $('#loginBtn');
  const emailEl   = $('#email');
  const loginMsg  = $('#loginMsg');
  const outBox    = $('#loggedOut');
  const inBox     = $('#loggedIn');
  const userEmail = $('#userEmail');
  const logoutBtn = $('#logoutBtn');

  let currentUser = null;
  let dbSyncAttached = false;

  loginBtn?.addEventListener('click', async () => {
    const email = (emailEl?.value || '').trim();
    if (!email){ loginMsg.textContent = 'Zadej e-mail.'; return; }
    loginMsg.textContent = 'Pos√≠l√°me odkaz...';
    const { error } = await supabase.auth.signInWithOtp({
      email,
      options: { emailRedirectTo: REDIRECT_URL }
    });
    loginMsg.textContent = error
      ? ('Chyba: ' + error.message)
      : 'Zkontroluj e-mail a klikni na odkaz.';
  });

  logoutBtn?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    currentUser = null;
    location.reload();
  });

  const { data: { session } } = await supabase.auth.getSession();
  if (session?.user) await onLogin(session.user);

  supabase.auth.onAuthStateChange(async (_ev, sess) => {
    if (sess?.user) await onLogin(sess.user);
  });

  async function onLogin(user){
    currentUser = user;

    outBox.style.display = 'none';
    inBox.style.display  = 'block';
    userEmail.textContent = user.email || user.id;

    const { data } = await supabase
      .from('progress')
      .select('lesson_id, done')
      .eq('user_id', user.id);

    const map = new Map((data || []).map(r => [r.lesson_id, !!r.done]));
    idsByCourse.flat().forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (map.has(id)) el.checked = map.get(id);
    });
    updateProgress();

    if (!dbSyncAttached){
      document.addEventListener('change', async (e) => {
        const t = e.target;
        if (!(t && t.id && t.type === 'checkbox')) return;
        localStorage.setItem('done:'+t.id, t.checked ? '1' : '0');
        if (currentUser){
          await supabase.from('progress').upsert({
            user_id: currentUser.id,
            lesson_id: t.id,
            done: !!t.checked
          });
        }
      });
      dbSyncAttached = true;
    }
  }
</script>

<!-- JEDIN√ù chat skript -->
<script>
(() => {
  const chatBox = document.getElementById('chatBox');
  const ask     = document.getElementById('ask');
  const askBtn  = document.getElementById('askBtn');

  if (!chatBox || !ask || !askBtn) {
    console.warn('Chat UI prvky nenalezeny.');
    return;
  }

  const API_URL = 'https://osobni-rozvoj-api.vercel.app/api/chat';

  function addBubble(text, who = 'user') {
    const b = document.createElement('div');
    b.className = `bubble ${who}`;
    b.textContent = text;
    chatBox.appendChild(b);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function autoresize() {
    ask.style.height = 'auto';
    ask.style.height = Math.min(ask.scrollHeight, 120) + 'px';
  }
  autoresize();
  ask.addEventListener('input', autoresize);

  async function send() {
    const text = (ask.value || '').trim();
    if (!text) return;

    addBubble(text, 'user');
    ask.value = '';
    autoresize();
    askBtn.disabled = true;

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: [{ role: 'user', content: text }] })
      });

      const data = await res.json().catch(() => ({}));
      const reply = data.reply || data.message || data.error || 'Nƒõco se pokazilo.';
      addBubble(reply, 'ai');
    } catch (e) {
      addBubble('Nepoda≈ôilo se spojit s API: ' + e.message, 'ai');
    } finally {
      askBtn.disabled = false;
      ask.focus();
    }
  }

  // Enter = odeslat, Shift+Enter = nov√Ω ≈ô√°dek
  ask.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  });

  askBtn.addEventListener('click', send);

  // Chips
  document.querySelectorAll('.chip').forEach(chip => {
    chip.addEventListener('click', () => {
      ask.value = chip.dataset.chip || chip.textContent;
      autoresize();
      ask.focus();
    });
  });

  // Voliteln√Ω pozdrav
  addBubble('Ahoj! Napi≈° zpr√°vu a stiskni Enter. üôÇ', 'ai');
})();
</script>

</body>
</html>
