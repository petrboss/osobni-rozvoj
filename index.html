<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Osobní rozvoj • MVP</title>
  <meta name="theme-color" content="#0f0f14">
  <style>
    :root{--bg:#0f0f14;--card:#161623;--muted:#2a2a36;--text:#e6e6e6;--accent:#7c9cff}
    *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;background:rgba(15,15,20,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid var(--muted)}
    .container{max-width:1100px;margin:0 auto;padding:14px 16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{font-weight:700;letter-spacing:.3px}
    .btn{background:var(--card);border:1px solid var(--muted);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{filter:brightness(1.06)}
    .hero{padding:32px 16px 8px}
    .hero h1{font-size:clamp(26px,5vw,40px);margin:8px 0 6px}
    .hero p{opacity:.85;margin:0 0 14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--muted);padding:14px;border-radius:14px}
    .tag{display:inline-block;background:#1c1c2b;border:1px solid var(--muted);padding:4px 8px;border-radius:999px;font-size:12px;opacity:.9}
    footer{border-top:1px solid var(--muted);padding:14px 16px;opacity:.8}
    .progress{height:8px;background:#1b1b28;border:1px solid var(--muted);border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:var(--accent);width:0%}
    .pill{display:inline-flex;align-items:center;gap:8px}
    .pill input{appearance:none;width:18px;height:18px;border:2px solid var(--accent);border-radius:4px}
    .pill input:checked{background:var(--accent)}
    @media (max-width:640px){.row-nav{flex-wrap:wrap;gap:8px}}
  </style>
</head>
<body>
<header>
  <div class="container row row-nav">
    <div class="brand">Osobní rozvoj (MVP)</div>
    <nav style="display:flex;gap:8px">
      <a class="btn" href="#kurzy">Kurzy</a>
      <a class="btn" href="#chat">Chat (brzy)</a>
      <a class="btn" href="#jak-dal">Jak dál</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <span class="tag">Krok 1: živý web</span>
    <h1>Platforma pro vzdělávání & osobní růst</h1>
    <p>Toto je první veřejná verze – jen statická stránka. Postupně přidáme přihlášení, databázi, AI chat a sociální prvky.</p>
    <button class="btn" onclick="document.querySelector('#kurzy').scrollIntoView({behavior:'smooth'})">Začít</button>
  </section>

  <section id="kurzy" style="padding:8px 0 20px">
    <h2>Kurzy (demo)</h2>
    <div class="grid">
      <article class="card">
        <h3>Základy mindsetu</h3>
        <p>Krátký úvod do práce s cíli, návyky a reflexí.</p>
        <div class="pill"><input type="checkbox" id="l1"><label for="l1">Lekce 1: Cíl vs. systém</label></div><br>
        <div class="pill"><input type="checkbox" id="l2"><label for="l2">Lekce 2: Denní reflexe</label></div><br>
        <div class="pill"><input type="checkbox" id="l3"><label for="l3">Lekce 3: Mini-návyk</label></div>
        <div style="margin-top:10px" class="progress"><div id="p1"></div></div>
      </article>
      <article class="card">
        <h3>Produktivita bez stresu</h3>
        <p>Jak plánovat týden a držet fokus.</p>
        <div class="pill"><input type="checkbox" id="l4"><label for="l4">Lekce 1: Týdenní plán</label></div><br>
        <div class="pill"><input type="checkbox" id="l5"><label for="l5">Lekce 2: 3 MITs denně</label></div><br>
        <div class="pill"><input type="checkbox" id="l6"><label for="l6">Lekce 3: Inbox Zero</label></div>
        <div style="margin-top:10px" class="progress"><div id="p2"></div></div>
      </article>
      <article class="card">
        <h3>Finance pro klid</h3>
        <p>Rozpočet, rezerva a jednoduché investice.</p>
        <div class="pill"><input type="checkbox" id="l7"><label for="l7">Lekce 1: 50/30/20</label></div><br>
        <div class="pill"><input type="checkbox" id="l8"><label for="l8">Lekce 2: Rezerva 3–6 měsíců</label></div><br>
        <div class="pill"><input type="checkbox" id="l9"><label for="l9">Lekce 3: ETF bez bolesti</label></div>
        <div style="margin-top:10px" class="progress"><div id="p3"></div></div>
      </article>
    </div>
  </section>

  <section id="chat" style="padding:8px 0 20px">
    <h2>Chat (brzy)</h2>
    <div class="card">
      <p>Zatím jen „maketa“. V dalším kroku přidáme opravdový backend a AI.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="q" placeholder="Napiš otázku…" style="flex:1;min-width:220px;padding:10px;border-radius:10px;border:1px solid var(--muted);background:#12121a;color:var(--text)">
        <button class="btn" onclick="alert('V dalším kroku napojíme AI na serveru.');">Zeptat se</button>
      </div>
    </div>
  </section>

<section id="ucet" style="padding:8px 0 20px">
  <h2>Účet</h2>
  <div class="card" id="authCard">
    <div id="loggedOut">
      <p>Přihlas se e-mailem (pošleme odkaz):</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="email" type="email" placeholder="tvoje@adresa.cz" style="flex:1;min-width:220px;padding:10px;border-radius:10px;border:1px solid var(--muted);background:#12121a;color:var(--text)">
        <button class="btn" id="loginBtn">Poslat přihlašovací odkaz</button>
      </div>
      <p id="loginMsg" style="opacity:.8;margin-top:8px"></p>
    </div>
    <div id="loggedIn" style="display:none">
      <p>Přihlášen: <span id="userEmail"></span></p>
      <button class="btn" id="logoutBtn">Odhlásit</button>
    </div>
  </div>
</section>

  
  <section id="jak-dal" style="padding:8px 0 32px">
    <h2>Jak budeme pokračovat</h2>
    <ol>
      <li><strong>Přihlášení + databáze</strong> (Supabase) – uživatelské účty, průběh lekcí.</li>
      <li><strong>AI chat</strong> přes serverovou route – bezpečně, bez odhalení API klíče.</li>
      <li><strong>PWA instalace</strong> – přidat na plochu, základní offline.</li>
      <li><strong>„Sociální“ vrstva</strong> – příspěvky, komentáře, sleduji/sledují.</li>
    </ol>
  </section>
</main>

<footer class="container">© 2025 Osobní rozvoj • MVP • Stavíme krok za krokem</footer>

<script>
  // Mini logika: ukládání „splněno“ do localStorage + progress bary
  const idsByCourse = [
    ['l1','l2','l3'],
    ['l4','l5','l6'],
    ['l7','l8','l9']
  ];
  function load(){
    idsByCourse.flat().forEach(id=>{
      const v = localStorage.getItem('done:'+id)==='1';
      const el = document.getElementById(id);
      if(el) el.checked = v;
    });
    updateProgress();
  }
  function updateProgress(){
    idsByCourse.forEach((arr,i)=>{
      const done = arr.filter(id=>localStorage.getItem('done:'+id)==='1').length;
      const pct = Math.round(done/arr.length*100);
      const bar = document.getElementById('p'+(i+1));
      if(bar) bar.style.width = pct+'%';
    });
  }
  document.addEventListener('change', (e)=>{
    if(e.target && e.target.id && e.target.type==='checkbox'){
      localStorage.setItem('done:'+e.target.id, e.target.checked?'1':'0');
      updateProgress();
    }
  });
  load();
</script>

 <script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

  // >>> tvoje údaje z Supabase (ponech tak, jak je máš) <<<
  const SUPABASE_URL  = 'https://qcknmwqnfpeknwqmlxgj.supabase.co';
  const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFja25td3FuZnBla253cW1seGdqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4NTY1ODUsImV4cCI6MjA3MTQzMjU4NX0.MrQgO3N2JHXOPHxxemVhu7MzbXlDkqDiMmVvZbVF_UE';
  const REDIRECT_URL  = 'https://petrboss.github.io/osobni-rozvoj/';

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

  // --- DOM ---
  const $ = (s)=>document.querySelector(s);
  const loginBtn = $('#loginBtn');
  const emailEl  = $('#email');
  const loginMsg = $('#loginMsg');
  const outBox   = $('#loggedOut');
  const inBox    = $('#loggedIn');
  const userEmail= $('#userEmail');
  const logoutBtn= $('#logoutBtn');

  // tyto dvě proměnné a funkce už máš v horním skriptu:
  // idsByCourse  = [['l1','l2','l3'], ...]
  // updateProgress() – přepočítá progress bary

  // --- LOGIN (magic link) ---
  loginBtn?.addEventListener('click', async () => {
    const email = (emailEl?.value || '').trim();
    if (!email){ loginMsg.textContent = 'Zadej e-mail.'; return; }
    loginMsg.textContent = 'Posíláme odkaz...';
    const { error } = await supabase.auth.signInWithOtp({
      email,
      options:{ emailRedirectTo: REDIRECT_URL }
    });
    loginMsg.textContent = error ? ('Chyba: '+error.message) : 'Zkontroluj e-mail a klikni na odkaz.';
  });

  // --- LOGOUT ---
  logoutBtn?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    location.reload();
  });

  // --- Po načtení: session + případné načtení progresu z DB ---
  const { data: { session } } = await supabase.auth.getSession();
  if (session?.user) await onLogin(session.user);
  supabase.auth.onAuthStateChange(async (_ev, sess) => {
    if (sess?.user) await onLogin(sess.user);
  });

  async function onLogin(user){
    // přepnout UI
    outBox.style.display = 'none';
    inBox.style.display  = 'block';
    userEmail.textContent = user.email || user.id;

    // 1) načíst progres z DB
    const { data, error } = await supabase
      .from('progress')
      .select('lesson_id, done')
      .eq('user_id', user.id);

    // 2) propsat do checkboxů a přepočítat progress bary
    const map = new Map((data||[]).map(r => [r.lesson_id, !!r.done]));
    idsByCourse.flat().forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      // pokud DB něco má, vezmeme stav z DB, jinak necháme co bylo
      if (map.has(id)) el.checked = map.get(id);
    });
    updateProgress();

    // 3) při každé změně ukládej i do DB (upsert)
    document.addEventListener('change', async (e) => {
      if (!(e.target && e.target.id && e.target.type === 'checkbox')) return;
      const id = e.target.id;
      const done = !!e.target.checked;
      await supabase.from('progress').upsert({
        user_id: user.id,
        lesson_id: id,
        done
      });
      // volitelně můžeš synchronně udržet i localStorage:
      localStorage.setItem('done:'+id, done ? '1' : '0');
    }, { once:false });
  }
</script>
</body>
</html>
